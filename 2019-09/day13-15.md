###### tags: `ç¬¬ 11 å±† iT é‚¦éµäººè³½`

# ç”¨ Flutter é–‹ç™¼ä¸€å€‹ Android App å§ - Day 13 ~ Day 15

> æœ¬ç³»åˆ—åŒæ­¥ç™¼è¡¨åœ¨ [**å€‹äººéƒ¨è½æ ¼**](https://bbsonlin.github.io/tags/ironman2020/)ï¼Œæ­¡è¿å¤§å®¶é—œæ³¨~

## Day 13. 

### ç™»å…¥é é¢çš„åœ–ç‰‡

å› ç‚ºç›®å‰æ­¤å°ˆæ¡ˆç‚º Gitme çš„ Reborn ç‰ˆæœ¬ï¼ŒåŸºæœ¬ä¸Šæˆ‘é‚„æ˜¯æœƒç›¡é‡é‚„åŸåŸç‰ˆ Gitme çš„è¨­è¨ˆã€‚  
åœ¨ç™»å…¥é é¢ä¸Šæ–°å¢ä¸€å€‹åœ–ç‰‡ã€‚

ä¿®æ”¹å¾Œï¼Œå¦‚åœ–

[![day13-1.png](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day13-1.png?raw=true)](https://github.com/BbsonLin/gitme_reborn/commit/bc0a9f1c9aba3e8aaf4a96ed02c1d9a93912ac57)


### App ç¸®åœ–

é‚„æœ‰å¦ä¸€å€‹å°å•é¡Œï¼Œç›®å‰åœ¨ App ç¸®åœ–çš„éƒ¨ä»½ï¼Œé‚„æ˜¯ä½¿ç”¨ Flutter é è¨­çš„ iconã€‚

![day13-2.jpeg](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day13-2.jpeg?raw=true)

å¦‚æœæƒ³æ›æ‰å®ƒï¼Œè©²æ€éº¼åšå‘¢ï¼Ÿ

éå¸¸æ„Ÿäººçš„æ˜¯ï¼Œåˆå‰›å¥½æœ‰ç¬¬ä¸‰æ–¹å¥—ä»¶å¯ä»¥ä½¿ç”¨ã€‚
ç”± Flutter Community æä¾›çš„ [flutter_launcher_icons](https://pub.dev/packages/flutter_launcher_icons#-readme-tab-)

åŸ·è¡Œæ­¥é©Ÿéå¸¸ç°¡å–®:

1. åœ¨ `pubspec.yaml` çš„ dependency åŠ å…¥ `flutter_launcher_icons: ^0.7.3`
2. åŠ å…¥ flutter_icons è¨­å®š
    ```
    flutter_icons:
      android: "launcher_icon" 
      ios: true
      image_path: "assets/icons/gitme-reborn-logo.png"
    ```
3. åœ¨ terminal ä¸­åŸ·è¡Œ `flutter pub run flutter_launcher_icons:main` åœ¨ android è·Ÿ ios çš„è³‡æ–™å¤¾ä¸­æœƒè‡ªå‹•ç”¢ç”Ÿ launcher_icon.png
    ```
    $ flutter pub run flutter_launcher_icons:main
    Android minSdkVersion = 16
    Creating default icons Android
    Adding a new Android launcher icon
    Overwriting default iOS launcher icon with new icon
    ```

ä¸‰æ­¥å°±å¤§åŠŸå‘Šæˆæ‹‰~

![day13-3.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day13-3.gif?raw=true)


### 0.0.1 ç‰ˆ

[å¾…è£œ]

### å°çµ

çµ‚æ–¼çµæŸæ­¤ç³»åˆ—çš„ç¬¬ä¸€éšæ®µ - UI éƒ¨ä»½äº†~~ ğŸ¤˜  
ä¹ŸæˆåŠŸçš„æ’å®Œéµäººè³½ 1/3 äº†~~ ğŸ‰

è€å¯¦èªªï¼Œç”¨ Flutter æ‹‰æ‰‹æ©Ÿ App UI ç®—æ˜¯å¥½ä¸Šæ‰‹çš„ã€‚  
ä½†æ˜¯è¦è©³ç´°å¼„æ‡‚å…§éƒ¨åŸç†ï¼Œå¯¦åœ¨æ˜¯éœ€è¦èŠ±æ»¿å¤šæ™‚é–“çš„ã€‚

å¸Œæœ›æœ‰å¹«åŠ©åˆ°é‡åˆ°ç›¸åŒå•é¡Œçš„äºº  
ä¸‹ä¸€å€‹éƒ¨ä»½ä¾†ä½œ API çš„ä¸²æ¥  
é‚£éº¼æ˜å¤©è¦‹å›‰~~


---

## Day 14.


ç¾åœ¨å„å¼å„æ¨£çš„è³‡æ–™éƒ½å­˜æ”¾åœ¨é›²ç«¯ï¼ŒApp æœ¬èº«ä¸æœƒå­˜å¤ªå¤šè³‡è¨Šï¼Œæ‰€ä»¥æ¥ Web API å¹¾ä¹æ˜¯ç¾ä»£ App å¿…ç„¶è¦ä½œçš„äº‹ã€‚

> æƒ³ç•¶åˆé«˜ä¸­çš„æ™‚å€™ï¼Œè½å€‹éŸ³æ¨‚éƒ½é‚„è¦ä¸‹è¼‰æ”¾åˆ° MP3ï¼Œç¾åœ¨éƒ½æ˜¯å„ç¨®ä¸²æµé˜¿...
 
æ—¢ç„¶æ˜¯ GitHub Appï¼Œå°±ä¸€å®šè¦ä¸²æ¥ GitHub çš„ API æ‹‰~

--

### æ¬¸!? å“ªäº› API é˜¿ï¼Ÿ

å…¶å¯¦é€™éšæ®µä¹Ÿå°±ä¸‰å€‹ API è¦ä¸²æ¥ã€‚  
åˆ†åˆ¥æ˜¯ GitHub APIã€Hacker News API å’Œ GitHub Trending API 

è€Œä¸”èªªæ˜¯ä¸²æ¥ï¼Œä¸éä½ ä¹ŸçŸ¥é“ï¼Œå¦‚æœæœ‰åˆ¥äººä½œå¥½çš„å¥—ä»¶ï¼Œç‚ºä½•ä¸ç”¨å‘¢ï¼Ÿ

å¾ˆå¹¸é‹çš„æ˜¯ï¼Œå‰å…©å€‹ APIï¼Œæˆ‘æœƒåˆ†åˆ¥ä½¿ç”¨ [`github`](https://pub.dev/packages/github) å’Œ [`hnpwa_client`](https://pub.dev/packages/hnpwa_client) é€™å…©å€‹å¥—ä»¶ã€‚

ä½†å¾ˆæ®˜å¿µçš„æ˜¯ï¼ŒGitHub Trending API çœ‹ä¾†æ˜¯å¿…é ˆè‡ªå·±æ¶æ§‹ç¨‹å¼ç¢¼...  
æ‰€ä»¥ GitHub Trending API é€™éƒ¨ä»½ï¼Œæˆ‘æ‰“ç®—æ”¾åˆ°é€™éšæ®µæœ€å¾Œå†è¬›ã€‚

--

å¥½æ‹‰ï¼Œè©±ä¸å¤šèªª!  
æˆ‘ç›´æ¥é€²å…¥ä¸»é¡Œå§~

### é¦–é  - Hacker News

`hnpwa_client` é€™å€‹å¥—ä»¶å‘¢ï¼Œå…¶å¯¦å®ƒä¸¦ä¸æ˜¯ç›´æ¥æ•´åˆå®˜æ–¹çš„ Hacker News APIï¼Œ
è€Œæ˜¯é€£æ¥ [`HNPWA api`](https://github.com/tastejs/hacker-news-pwas) é€™å€‹ Project çš„ APIã€‚  

å€‹äººè¦ºå¾—åŸå› åœ¨æ–¼:
1. `HNPWA api` æ˜¯å°ˆé–€ç‚º PWA æˆ– Mobile App è¨­è¨ˆçš„ã€‚
2. è¨­è¨ˆçš„æ¯”å®˜æ–¹çš„ API é‚„å¥½ä½¿ç”¨ã€‚

--

æˆ‘ä¿®æ”¹çš„æ­¥é©Ÿå¾ˆç°¡å–®:

1. åœ¨ `_HomePageState` è£¡å¯« `final HnpwaClient hnClient = HnpwaClient();`ï¼Œå®£å‘Š `hnClient` é€™å€‹è®Šæ•¸æ–¹ä¾¿åœ¨é€™å€‹ State è£¡é¢ä½¿ç”¨ã€‚
2. é‡å¯«(override) `initState()` å‡½æ•¸ï¼Œèª¿ç”¨æˆ‘è‡ªå·±å¯«çš„å‡½æ•¸ `fetchHNData()`
3. `fetchHNData()` è£¡é¢èª¿ç”¨ `hnpwa_client` çš„æ–¹æ³• `hnClient.news()` å’Œ `hnClient.newest()`ã€‚
4. åœ¨ setState å‡½æ•¸è£¡æŒ‡å®šå€¼çµ¦ `_hnTops` å’Œ `_hnNews` é€™å…©å€‹è®Šæ•¸ã€‚
    ```
    _hnTops = hnNew.items;
    _hnNews = hnNewest.items;
    ```

[![day14-1.jpeg](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day14-1.jpeg?raw=true)](https://github.com/BbsonLin/gitme_reborn/commit/ba59ff7a3b589c64ee1fe8193fe591220fb141c4)

æ”¹å®Œä¹‹å¾Œï¼Œå†æœ‰é€£ç·šç‹€æ…‹æ™‚ä¸€é€²åˆ°é¦–é å°±æœƒè®€å– Hacker News å›‰~

![day14-2.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day14-2.gif?raw=true)



### é–‹å•Ÿ Hack News é€£çµ

é€™é‚Šç¨å¾®å†åšä¸€å€‹ç°¡æ˜“çš„åŠŸèƒ½ï¼Œå°±æ˜¯é»æ“Š Hack News çš„ ListTile å¾Œæœƒè‡ªå‹•ç”¨ç€è¦½å™¨é–‹å•Ÿé€£çµã€‚

é€™å€‹æ™‚å€™éå¸¸ç°¡å–®çš„ä¾è³´å¦ä¸€å€‹ Flutter Team é–‹ç™¼çš„å¥—ä»¶ [`url_launcher`](https://pub.dev/packages/url_launcher)ã€‚  
å®ƒæœƒå¹«ä½ è‡ªå‹•çš„ç”¨ä½ æ‰‹æ©Ÿç³»çµ±(iOS è·Ÿ Android éƒ½æ”¯æ´)é è¨­çš„æ–¹å¼é–‹å•Ÿ URLï¼Œä¸è«–æ˜¯ `http(s)` ã€`mailto`ã€`tel` è·Ÿ `sms` éƒ½æœƒè™•ç†å–”~

[![day14-3.jpeg](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day14-3.jpeg?raw=true)](https://github.com/BbsonLin/gitme_reborn/commit/343a2cfc4f4ab18e73f79863797b99a9be5db1a3#diff-d3cda190df50f3330b22952d914ba8fe)

`lib/utils.dart`

``` dart
import "package:flutter/material.dart";
import 'package:url_launcher/url_launcher.dart';

Color hexToColor(String code) {...}

Future launchURL(url) async {
  if (await canLaunch(url)) {
    await launch(url);
  } else {
    throw 'Could not launch $url';
  }
}
```

ç¨‹å¼ä¸Šéå¸¸ç°¡å–®ï¼Œåœ¨ `ListTile` çš„ `onTap` èª¿ç”¨ `launchURL`ï¼Œé€™æ¨£å°±å¯ä»¥å›‰~

![day14-4.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day14-4.gif?raw=true)

--

ä»Šå¤©ä¸»è¦æ˜¯é€²å…¥ç¬¬äºŒéšæ®µçš„ç¬¬ä¸€å¤©ï¼Œå…ˆå°è©¦èº«æ‰‹ï¼Œç¨‹å¼ç¢¼çš„éƒ¨ä»½ä¸¦ä¸é›£ã€‚  
ä¹‹å¾Œæœƒæ…¢æ…¢é€²å…¥æœ€ä¸»è¦çš„ GitHub API å›‰~


---

## Day 15.

### GitHub API åˆé«”é©—

æœ¬äººåœ¨é€™å°ˆæ¡ˆä¹‹å‰æ˜¯å®Œå…¨æ²’ä½¿ç”¨é GitHub API çš„ï¼Œæ‰€ä»¥æˆ‘æ˜¯ä»¥æ–°æ‰‹ä¹‹å§¿ä¾†ä¸²æ¥å®ƒã€‚  
å¦‚æœæœ‰ç†è§£éŒ¯çš„ï¼Œå¸Œæœ›å¤§å®¶ç•™è¨€å‘Šè¨´æˆ‘å›‰~

ç›®å‰æˆ‘ä½¿ç”¨æ­¥é©Ÿæ˜¯

1. é¦–å…ˆè¦æœ‰å€‹ GitHub å¸³è™Ÿ(å»¢è©±)
2. å†åˆ°å€‹äººçš„è¨­å®šé é¢æ‹¿ [Persional access token](https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line)ï¼Œé–‹ç™¼æ¸¬è©¦æ™‚ä½¿ç”¨ã€‚
3. æœ€å¾Œæ‹¿ token å°±å¯ä»¥å°æ¥ GitHub REST API v3 äº†ã€‚

> å°æé†’:
>
> * Persional access token æˆ‘å€‹äººèªçŸ¥æ˜¯æ‹¿ä¾†è‡ªå·±é–‹ç™¼æ¸¬è©¦ç”¨ï¼Œä¹‹å¾Œè‹¥æœ‰é–‹æ”¾å‡ºä¾†çµ¦åˆ¥äººä¸‹è¼‰ä½¿ç”¨çš„è©±ï¼Œæ‡‰è©²è¦å»ºç«‹ [Oauth App](https://developer.github.com/v3/guides/basics-of-authentication/) çš„ï¼Œç”¨ Oauth2 èªè­‰æ–¹å¼ä¾†æ‹¿åˆ°åˆ¥çš„ç”¨æˆ¶æˆæ¬Šã€‚
> * GitHub API ç›®å‰çš„æƒ³æ³•æ˜¯ä»¥æ­é… [`github`](https://pub.dev/packages/github) é€™å€‹å¥—ä»¶ä¾†ä½œä¸²æ¥ã€‚


### å€‰åº«é  - æ”¹

æ¥ä¸‹ä¾†æˆ‘å€‘å°±ç›´æ¥å¯¦éš›ä¸Šä½¿ç”¨çœ‹çœ‹ã€‚

æˆ‘å…ˆåœ¨å‰µå»ºä¸€å€‹æ–°çš„æª”æ¡ˆ `lib/services/github_api.dart`

``` dart
import 'package:flutter_dotenv/flutter_dotenv.dart';
import 'package:github/server.dart';

GitHub githubClient = GitHub(
  auth: Authentication.withToken(DotEnv().env["GITHUB_PERSONAL_ACCESS_TOKEN"]),
);
```

ä¸»è¦ç›®çš„æ˜¯è¦å®£å‘Šå‡ºä¸€å€‹å…¨åŸŸè®Šæ•¸ `githubClient`ï¼Œæ–¹ä¾¿å¾ŒçºŒå…¶ä»–é é¢ä¹Ÿèƒ½ä½¿ç”¨ã€‚

é€™è£¡å’Œä½œå¤©ä¸€æ¨£æˆ‘å‰µå»ºäº† `fetchRepos()` å‡½æ•¸ï¼Œè£¡é ­ä¾†ç²å–æˆ‘å€‹äººçš„æ‰€æœ‰ repoã€‚  
æ¥è‘—åœ¨ `initState()` å‡½æ•¸è£¡å°‡ `fetchRepos()` assign çµ¦ `repoList`ï¼Œé€™æ¨£å‰ç½®ä½œæ¥­å°±ç®—å®Œæˆæ‹‰~

æœ€å¾Œæ¯”è¼ƒè¤‡é›œçš„éƒ¨ä»½ï¼Œæˆ‘é¸æ“‡ä½¿ç”¨ Flutter åŸç”Ÿæä¾›ä¸€å€‹æ–¹ä¾¿çš„ Widget -- `FutureBuilder`ã€‚  
å°‡æœ€ä¸»è¦çš„å…§å®¹éƒ¨ä»½ä»¥é€™å€‹ Widget ä¾†ä½œäº›æ”¹å¯«ï¼Œå…ˆä¾†çœ‹çœ‹ç¨‹å¼ç¢¼ã€‚

``` dart
...

  @override
  Widget build(BuildContext context) {
    return Scrollbar(
      child: RefreshIndicator(
        child: FutureBuilder(
          future: repoList,
          builder:
              (BuildContext context, AsyncSnapshot<List<Repository>> snapshot) {
            switch (snapshot.connectionState) {
              case ConnectionState.done:
                if (!snapshot.hasError) {
                  return ListView.separated(
                    padding: EdgeInsets.all(0.0),
                    itemCount: snapshot.data.length,
                    itemBuilder: (BuildContext context, int index) {
                      return ListTile(
                        title: Text(
                            "${snapshot.data[index].owner.login}/${snapshot.data[index].name}"),
                        subtitle: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: <Widget>[
                            SizedBox(height: 8.0),
                            snapshot.data[index].description != null
                                ? Text(snapshot.data[index].description)
                                : Text("No description provided."),
                            SizedBox(height: 8.0),
                            Text("â˜… ${snapshot.data[index].stargazersCount}"),
                          ],
                        ),
                        trailing: snapshot.data[index].language != null
                            ? Text(snapshot.data[index].language)
                            : SizedBox(),
                        contentPadding: EdgeInsets.symmetric(
                            vertical: 8.0, horizontal: 16.0),
                        onTap: () {},
                      );
                    },
                    separatorBuilder: (BuildContext context, int index) =>
                        const Divider(height: 0.0),
                  );
                } else {
                  return Center(child: Text("No Data"));
                }
                break;
              case ConnectionState.none:
              case ConnectionState.active:
              case ConnectionState.waiting:
                return Center(child: CircularProgressIndicator());
            }
          },
        ),
        onRefresh: () async {
          await Future.delayed(Duration(seconds: 1));
          setState(() {
            repoList = fetchRepos();
          });
        },
      ),
    );
  }
  
  Future<List<Repository>> fetchRepos() async {
    ...
  }
```

ç¨‹å¼ç¢¼çœ‹èµ·ä¾†å¾ˆé•·ï¼Œä½†æœ€ä¸»è¦çš„æ¦‚å¿µå°±æ˜¯æˆ‘å°‡åŸæœ¬ `ListView.separated` çš„éƒ¨ä»½åŒ…é€²äº† `FutureBuilder` è£¡ã€‚

è€Œä½¿ç”¨ `FutureBuilder` æœ‰å…©å¤§é‡é»:
* `future` å±¬æ€§éœ€è¦å¸¶å…¥ä½ è¦åŸ·è¡Œçš„ç•°æ­¥ä»»å‹™(é€™è£¡å°±æ˜¯æŒ‡ç²å– repos)
* `builder` å±¬æ€§éœ€è¦å¡«å…¥ä½ æ‰€æƒ³è¦å‰µå»ºçš„å…§å®¹ï¼Œè€ŒåŸ·è¡Œç•°æ­¥ä»»å‹™å®Œçš„çµæœï¼Œå¯ä»¥åœ¨å‡½æ•¸ç¬¬äºŒå€‹åƒæ•¸ `AsyncSnapshot snapshot` ä¾†ä½œä½¿ç”¨ã€‚

> å°æé†’:
>
> * ä½¿ç”¨ `FutureBuilder` å…¶å¯¦é‚„æœ‰ä¸€å€‹å¥½è™•ï¼Œå¯ä»¥åœ¨ `build` è£¡é¢è™•ç† `snapshot.connectionState` ï¼Œæ¯”å¦‚æœ‰ é€£ç·šç•°å¸¸ æˆ– è¼‰å…¥è³‡æ–™ä¸­çš„æƒ…æ³ï¼Œèƒ½ç›´æ¥ç”¨ switch case åˆ‡æ› Widget ä¾†è¡¨ç¤ºé€™äº›ç‹€æ…‹ã€‚
> * åœ¨é–‹ç™¼é€”ä¸­ç™¼ç¾å¦‚æœæ­é… `FutureBuilder` çš„è©±ï¼Œ`RefreshIndicator.onRefresh` çš„ä½¿ç”¨ä¸Šéœ€ä½œäº›ä¿®æ”¹ã€‚(åƒè€ƒ: [HOW TO REFRESH FUTUREBUILDER ON BUTTON CLICK IN FLUTTER](https://inducesmile.com/google-flutter/how-to-refresh-futurebuilder-on-button-click-in-flutter/))
> * é—œæ–¼ Personal access token æˆ‘ä½¿ç”¨ [`flutter_dotenv`](https://pub.dev/packages/flutter_dotenv) é€™å¥—ä»¶ä¾†è¼‰å…¥æˆ‘çš„ `.env` è¨­å®šæª”ï¼Œä¸»è¦æ˜¯ç‚ºäº›å®‰å…¨ä¸Šä½œè€ƒé‡å›‰~

--

æˆæœ

[![day15-1.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day15-1.gif?raw=true)](https://github.com/BbsonLin/gitme_reborn/commit/0883d33da2569f0983f6f267b0ba215c0bac58ae)


--

éµäººè³½é»˜é»˜çš„ä¹Ÿéäº†ä¸€åŠäº†~  
é€™å¹¾å¤©å°å¼Ÿè¼ƒå¿™ï¼ŒåŸè«’å°å¼Ÿä»Šå¤©å…ˆä»¥ç°¡çŸ­çš„å…§å®¹åšæ”¶~

