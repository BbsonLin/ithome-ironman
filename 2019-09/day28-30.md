###### tags: `第 11 屆 iT 邦鐵人賽`

# 用 Flutter 開發一個 Android App 吧 - Day 28 ~ Day 30

> 本系列同步發表在 [**個人部落格**](https://bbsonlin.github.io/tags/ironman2020/)，歡迎大家關注~
> 

## Day 28. 主題切換

30 天的最後一個部份就是要用狀態管理來實現 App 設定頁面功能。

今天要先來面對的是**主題切換**。

### 主題常數

前面二十幾天，都在作其他頁面的功能，其實 Flutter 主打的功能之一是能夠很迅速的找到適合自己 App 的主題色彩。先前全部都是使用 `Colors.bluegrey` 當作主色調，要有切換不同主題的功能前必須要先宣告一些主題常數。

`lib/constants/themes.dart`
``` dart
import "package:flutter/material.dart";

final BlueTheme = ThemeData(
  primarySwatch: Colors.blue,
  buttonTheme: ButtonThemeData(
    buttonColor: Colors.blue,
    textTheme: ButtonTextTheme.primary,
  ),
);

final BlueGreyTheme = ThemeData(
  primarySwatch: Colors.blueGrey,
  buttonTheme: ButtonThemeData(
    buttonColor: Colors.blueGrey,
    textTheme: ButtonTextTheme.primary,
  ),
);

final BrownTheme = ThemeData(
  primarySwatch: Colors.brown,
  buttonTheme: ButtonThemeData(
    buttonColor: Colors.brown,
    textTheme: ButtonTextTheme.primary,
  ),
);

final BlackTheme = ThemeData(
  primarySwatch: Colors.black,
  buttonTheme: ButtonThemeData(
    buttonColor: Colors.black,
    textTheme: ButtonTextTheme.primary,
  ),
);
```

加上四個主題顏色的常數。

### 管理設定狀態

`lib/stores/setting.dart`
``` dart
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';

import 'package:gitme_reborn/constants/themes.dart';

class SettingModel extends ChangeNotifier {
  ThemeData _themeData = BlueGreyTheme;

  ThemeData get theme => _themeData;

  changeTheme(themeData) {
    _themeData = themeData;
    notifyListeners();
  }
}
```

`lib/main.dart`
![day28-1.png](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-1.png?raw=true)


`lib/pages/setting/setting.dart`
![day28-2.png](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-2.png?raw=true)


### 無法切換的主題

先來跑看看改完的程式碼

![day28-3.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-3.gif?raw=true)

不過出現了一個小問題，在切換成黑色主題時會出現以下錯誤。

![day28-4.png](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-4.png?raw=true)

主要是因為 `Colors.black` 並非 `MaterialColor`，而 `MaterialColor` 這類別是針對 Material Design 中 [The color system](https://material.io/design/color/#) 作的程式設計。  
在參考 [StackOverflow - Error while changing the flutter theme color to black](https://stackoverflow.com/questions/52577366/error-while-changing-the-flutter-theme-color-to-black) 後，新增修改些程式碼。

`lib/constants/materialColors.dart`
``` dart
import "package:flutter/material.dart";

const MaterialColor materialBlack = MaterialColor(
  _blackPrimaryValue,
  <int, Color>{
    50: Color(0xFF000000),
    100: Color(0xFF000000),
    200: Color(0xFF000000),
    300: Color(0xFF000000),
    400: Color(0xFF000000),
    500: Color(_blackPrimaryValue),
    600: Color(0xFF000000),
    700: Color(0xFF000000),
    800: Color(0xFF000000),
    900: Color(0xFF000000),
  },
);
const int _blackPrimaryValue = 0xFF000000;
```

`lib/constants/themes.dart`
![day28-6.png](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-6.png?raw=true)


--

成果

![day28-5.gif](https://github.com/BbsonLin/ithome-ironman/blob/master/2019-09/images/day28-5.gif?raw=true)



*參考*

* [Medium - How To Create a Dynamic Theme in Flutter Using Provider](https://medium.com/better-programming/how-to-create-a-dynamic-theme-in-flutter-using-provider-e6ad1f023899)
* [YouTube - Flutter: Dynamic Dark/Light Theme with Provider](https://youtu.be/G7gV89hnooM)
* [GitHub - rxlabz/panache](https://github.com/rxlabz/panache)

